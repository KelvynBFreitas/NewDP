<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadastro de Prestador</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />

    <style>
      /* --- TEMA REVERTIDO PARA CIANO (Combina com a Aurora) --- */
      :root {
        --cor-fundo-gradiente-1: #10161d;
        --cor-fundo-gradiente-2: #090e13; /* Fundo principal */
        --cor-card-fundo: rgba(255, 255, 255, 0.15);
        --cor-card-fundo-hover: rgba(255, 255, 255, 0.25);
        --cor-card-borda: rgba(255, 255, 255, 0.25);
        --cor-texto-claro: #c2cbd6;
        --cor-texto-branco: #e0e6ec;

        /* Cores de Destaque (Ciano Original) */
        --cor-destaque-primaria: #00bcd4; /* Ciano */
        --cor-destaque-secundaria: #0087a3; /* Ciano escuro */

        --cor-shadow-leve: rgba(0, 0, 0, 0.2);
        --cor-shadow-media: rgba(0, 0, 0, 0.4);
        --cor-shadow-intensa: rgba(0, 0, 0, 0.6);
        --cor-sucesso: #198754;
        --cor-sucesso-hover: #157347;
      }
      body {
        /* --- MUDAN√áA: Fundo s√≥lido. A anima√ß√£o vem dos DIVs. --- */
        background: var(--cor-fundo-gradiente-2);
        min-height: 100vh;
        font-family: "Inter", Arial, sans-serif;
        color: var(--cor-texto-claro);
        overflow-x: hidden;
        padding-top: 50px;
      }

      /* --- MUDAN√áA: REMOVIDO 'body::before' e 'body::after' --- */
      /* O CSS antigo para os glows de fundo foi removido. */

      /* --- MUDAN√áA: ADICIONADO NOVO FUNDO AURORA (Estilo Trae.ai) --- */
      .aurora-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -2; /* Atr√°s de todo o conte√∫do */
        overflow: hidden;
        filter: blur(90px); /* O blur pesado que faz a m√°gica */
        opacity: 0.25; /* Sutil, para n√£o cansar a vista */
      }

      .aurora-blob {
        position: absolute;
        width: 60vw; /* Tamanho grande */
        height: 60vw;
        min-width: 500px;
        min-height: 500px;
        background-color: var(--cor-blob);
        border-radius: 50%;
        /* Anima√ß√£o complexa com bezier para suavidade */
        animation: aurora-anim 30s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite;
      }

      /* Posi√ß√µes e delays diferentes para cada bolha */
      .aurora-blob:nth-child(1) {
        top: -30vh;
        left: -15vw;
        animation-delay: 0s;
        animation-duration: 32s;
      }
      .aurora-blob:nth-child(2) {
        top: 10vh;
        right: -20vw;
        animation-delay: -8s;
        animation-duration: 30s;
      }
      .aurora-blob:nth-child(3) {
        bottom: -25vh;
        left: 20vw;
        animation-delay: -16s;
        animation-duration: 28s;
      }
      .aurora-blob:nth-child(4) {
        bottom: 0vh;
        right: 30vw;
        animation-delay: -24s;
        animation-duration: 34s;
      }

      /* A anima√ß√£o que move, escala e gira */
      @keyframes aurora-anim {
        0% {
          transform: translate(0, 0) scale(1) rotate(0deg);
        }
        25% {
          transform: translate(40vw, 30vh) scale(1.2) rotate(30deg);
        }
        50% {
          transform: translate(10vw, -20vh) scale(0.8) rotate(60deg);
        }
        75% {
          transform: translate(-30vw, 20vh) scale(1.1) rotate(90deg);
        }
        100% {
          transform: translate(0, 0) scale(1) rotate(0deg);
        }
      }
      /* --- FIM DO FUNDO AURORA --- */

      .navbar-custom {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 4px 30px var(--cor-shadow-leve);
        padding: 0.8rem 1.5rem;
        z-index: 1040;
      }
      .navbar-custom .navbar-brand {
        color: var(--cor-texto-branco);
        font-weight: 700;
        font-size: 1.3rem;
        text-shadow: 0 0 5px rgba(0, 188, 212, 0.2); /* Tema Ciano */
      }
      .navbar-custom .nav-link {
        color: var(--cor-texto-claro);
        font-weight: 500;
        transition: all 0.3s ease;
        padding: 0.5rem 1rem;
        border-radius: 8px;
      }
      .navbar-custom .nav-link:hover,
      .navbar-custom .nav-link.active {
        color: var(--cor-texto-branco);
        background-color: rgba(255, 255, 255, 0.05);
        text-shadow: 0 0 3px rgba(0, 188, 212, 0.2); /* Tema Ciano */
      }
      .navbar-toggler {
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .navbar-toggler-icon {
        filter: invert(1);
      }
      .dropdown-menu {
        background: rgba(18, 28, 38, 0.9);
        backdrop-filter: blur(15px);
        border: 1px solid var(--cor-card-borda);
        box-shadow: 0 15px 40px var(--cor-shadow-media);
        border-radius: 12px;
        padding: 0.75rem 0;
      }
      .dropdown-item {
        color: var(--cor-texto-claro) !important;
        font-weight: 500;
        padding: 0.6rem 1.25rem;
        transition: all 0.2s ease;
      }
      .dropdown-item:hover {
        background-color: rgba(0, 188, 212, 0.15); /* Tema Ciano */
        color: var(--cor-destaque-primaria) !important;
      }
      .dropdown-item-text {
        color: var(--cor-texto-branco) !important;
        padding: 0.6rem 1.25rem;
        font-weight: 600;
      }
      .dropdown-divider {
        border-color: rgba(255, 255, 255, 0.1);
        margin: 0.5rem 0;
      }
      .dashboard-container {
        max-width: 90%;
        margin: 40px auto;
        padding: 35px 30px;
        background: var(--cor-card-fundo);
        backdrop-filter: blur(12px);
        border: 1px solid var(--cor-card-borda);
        border-radius: 10px;
        box-shadow: 0 15px 40px var(--cor-shadow-media);
        position: relative;
        overflow: hidden;
      }
      /* Borda animada (ainda funciona bem) */
      .dashboard-container::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(
          45deg,
          var(--cor-destaque-primaria) 0%,
          #007bff 25%,
          var(--cor-destaque-primaria) 50%,
          #007bff 75%,
          var(--cor-destaque-primaria) 100%
        );
        background-size: 200% 200%;
        border-radius: 20px;
        z-index: -1;
        animation: gradient-border 10s ease infinite;
        opacity: 0.5;
      }
      @keyframes gradient-border {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .dashboard-container h2 {
        color: var(--cor-texto-branco);
        font-weight: 400;
        text-shadow: 0 0 10px rgba(0, 188, 212, 0.4); /* Tema Ciano */
        margin-bottom: 1.5rem !important;
      }
      .dashboard-container p {
        color: var(--cor-texto-claro);
        font-size: 1.05rem;
        margin-bottom: 2rem !important;
      }
      #saudacao {
        color: var(--cor-texto-branco);
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 0.25rem !important;
      }
      .table-container-custom {
        background: var(--cor-card-fundo);
        backdrop-filter: blur(8px);
        border: 1px solid var(--cor-card-borda);
        border-radius: 15px;
        padding: 0;
        box-shadow: 0 5px 20px var(--cor-shadow-leve);
        overflow: hidden;
      }
      .table-custom {
        background-color: transparent;
        color: var(--cor-texto-claro);
        border-color: var(--cor-card-borda);
        margin-bottom: 0;
      }
      .table-custom th {
        color: var(--cor-texto-branco);
        font-weight: 300;
        border-color: var(--cor-card-borda) !important;
        background-color: rgba(255, 255, 255, 0.05);
      }
      .table-custom td {
        border-color: var(--cor-card-borda) !important;
        vertical-align: middle;
      }
      .table-custom.table-striped > tbody > tr:nth-of-type(even) {
        background-color: rgba(0, 0, 0, 0.15);
      }
      .table-custom.table-striped > tbody > tr:nth-of-type(odd) {
        background-color: transparent;
      }
      .table-custom tbody tr:hover {
        background-color: var(--cor-card-fundo-hover);
        color: var(--cor-texto-branco);
      }
      .table-container-custom .table-responsive-lg {
        padding: 0.5rem;
      }
      .table-custom th,
      .table-custom td {
        padding: 0.85rem 1rem;
        font-size: 0.88rem;
      }
      .form-control-custom {
        background: var(--cor-card-fundo);
        border: 1px solid var(--cor-card-borda);
        color: var(--cor-texto-branco);
        border-radius: 0.375rem;
        transition: all 0.3s ease;
      }
      .form-control-custom:focus {
        background: var(--cor-card-fundo);
        border-color: var(--cor-destaque-primaria);
        color: var(--cor-texto-branco);
        box-shadow: 0 0 0 0.25rem rgba(0, 188, 212, 0.25); /* Tema Ciano */
      }
      .form-control-custom::placeholder {
        color: var(--cor-texto-claro);
        opacity: 0.7;
      }
      .btn-search-custom {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--cor-card-borda);
        color: var(--cor-destaque-primaria);
        transition: all 0.2s ease;
      }
      .btn-search-custom:hover {
        background: var(--cor-destaque-primaria);
        color: var(--cor-fundo-gradiente-1);
        border-color: var(--cor-destaque-primaria);
      }
      .fab-base {
        position: fixed;
        z-index: 1050;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 0.5px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px var(--cor-shadow-intensa);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        color: var(--cor-texto-branco);
        cursor: pointer;
        text-decoration: none;
      }
      .fab-base:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 12px 30px var(--cor-shadow-intensa);
      }
      .notification-button {
        bottom: 25px;
        right: 25px;
        font-size: 1.6rem;
        background: rgba(0, 188, 212, 0.85); /* Tema Ciano */
      }
      .notification-button:hover {
        background: var(--cor-destaque-primaria);
        box-shadow: 0 15px 40px rgba(0, 188, 212, 0.6);
      }
      .notification-button .badge {
        font-size: 0.7rem;
        padding: 5px 8px;
        position: absolute;
        top: 0px;
        right: 0px;
        transform: translate(25%, -25%);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 2px 8px var(--cor-shadow-leve);
      }
      .fab-add-button {
        bottom: 95px; /* Acima do bot√£o de notifica√ß√£o */
        right: 25px;
        font-size: 2rem;
        background-color: var(--cor-sucesso);
      }
      .fab-add-button:hover {
        background-color: var(--cor-sucesso-hover);
        box-shadow: 0 15px 40px rgba(25, 135, 84, 0.6);
      }
      .modal-content-custom {
        background: #0e2231b0;
        backdrop-filter: blur(15px);
        border: 1px solid var(--cor-card-borda);
        border-radius: 15px;
        color: var(--cor-texto-claro);
        box-shadow: 0 15px 40px var(--cor-shadow-media);
      }
      .modal-content-custom .modal-header {
        border-bottom: 1px solid var(--cor-card-borda);
      }
      .modal-content-custom .modal-header .modal-title {
        color: var(--cor-texto-branco);
        font-weight: 600;
      }
      .modal-content-custom .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
      }
      .modal-content-custom .modal-body .form-label {
        color: var(--cor-texto-claro);
        font-weight: 500;
      }
      .modal-content-custom .form-control-custom {
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--cor-card-borda);
        color: var(--cor-texto-branco);
      }
      .modal-content-custom .form-control-custom:focus {
        background: rgba(0, 0, 0, 0.556);
        border-color: var(--cor-destaque-primaria);
        color: var(--cor-texto-branco);
        box-shadow: 0 0 0 0.25rem rgba(213, 215, 215, 0);
      }
      .modal-content-custom .form-control-custom::placeholder {
        color: var(--cor-texto-claro);
        opacity: 0.5;
      }
      .modal-content-custom .modal-footer {
        border-top: 1px solid var(--cor-card-borda);
      }
      .pagination .page-item .page-link {
        background-color: var(--cor-card-fundo);
        border-color: var(--cor-card-borda);
        color: var(--cor-texto-claro);
        margin: 0 2px;
        border-radius: 0.375rem;
      }
      .pagination .page-item .page-link:hover {
        background-color: var(--cor-card-fundo-hover);
        color: var(--cor-texto-branco);
      }
      .pagination .page-item.active .page-link {
        background-color: var(--cor-destaque-primaria);
        border-color: var(--cor-destaque-primaria);
        color: var(--cor-fundo-gradiente-1);
        font-weight: 600;
      }
      .pagination .page-item.disabled .page-link {
        background-color: rgba(0, 0, 0, 0.1);
        border-color: var(--cor-card-borda);
        color: var(--cor-texto-claro);
        opacity: 0.5;
      }
      .table-custom .btn {
        padding: 0.25rem 0.6rem;
        font-size: 0.9rem;
        transition: all 0.25s ease;
      }
      .table-custom .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }
      .modal-footer .btn-outline-secondary {
        color: var(--cor-texto-claro);
        border-color: var(--cor-card-borda);
        background: transparent;
        transition: all 0.25s ease;
      }
      .modal-footer .btn-outline-secondary:hover {
        background-color: var(--cor-card-fundo-hover);
        border-color: var(--cor-texto-claro);
        color: var(--cor-texto-branco);
        transform: scale(1.03);
      }
      .modal-footer .btn-success,
      .modal-footer .btn-warning {
        transition: all 0.25s ease;
      }
      .modal-footer .btn-success:hover {
        transform: scale(1.03);
        box-shadow: 0 0 20px rgba(25, 135, 84, 0.5);
      }
      /* --- MUDAN√áA: Bot√£o Warning (Alterar) no tema Ciano --- */
      /* O bot√£o de Alterar agora ser√° Ciano, n√£o Amarelo */
      .modal-footer .btn-warning {
        background-color: var(--cor-destaque-primaria);
        border-color: var(--cor-destaque-primaria);
        color: var(--cor-fundo-gradiente-1) !important;
      }
      .modal-footer .btn-warning:hover {
        transform: scale(1.03);
        background-color: var(--cor-destaque-secundaria);
        border-color: var(--cor-destaque-secundaria);
        box-shadow: 0 0 20px rgba(0, 188, 212, 0.5);
      }
      /* O bot√£o na tabela tamb√©m (era Amarelo) */
      .table-custom .btn-warning {
        background-color: var(--cor-destaque-primaria);
        border-color: var(--cor-destaque-primaria);
        color: var(--cor-fundo-gradiente-1) !important;
      }
      .table-custom .btn-warning:hover {
        background-color: var(--cor-destaque-secundaria);
        border-color: var(--cor-destaque-secundaria);
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: var(--cor-fundo-gradiente-2);
      }
      ::-webkit-scrollbar-thumb {
        background-color: var(--cor-card-borda);
        border-radius: 10px;
        border: 2px solid var(--cor-fundo-gradiente-2);
      }
      ::-webkit-scrollbar-thumb:hover {
        background-color: var(--cor-destaque-primaria);
      }
      @media (max-width: 768px) {
        body {
          padding-top: 70px;
        }
        .navbar-custom {
          padding: 0.6rem 1rem;
        }
        .dashboard-container {
          padding: 25px 15px;
          margin: 20px auto;
        }
        .dashboard-container h2 {
          font-size: 1.8rem;
          text-align: center;
        }
        .dashboard-container p {
          font-size: 0.95rem;
          text-align: center;
        }
        #saudacao {
          text-align: center !important;
        }
        .notification-button,
        .fab-add-button {
          width: 50px;
          height: 50px;
          right: 15px;
        }
        .notification-button {
          bottom: 15px;
          font-size: 1.3rem;
        }
        .fab-add-button {
          bottom: 75px; /* 15 + 50 + 10 */
          font-size: 1.8rem;
        }
        .notification-button .badge {
          font-size: 0.6rem;
          padding: 3px 5px;
          top: -2px;
          right: -2px;
        }
        .pagination {
          justify-content: center !important;
        }
      }
      /* --- CORRE√á√ÉO DA TABELA (Mantida) --- */
      /* O 'white-space: nowrap;' foi removido */

      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: var(--cor-fundo-gradiente-2);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        opacity: 1;
        transition: opacity 0.3s ease-in-out;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid var(--cor-card-borda);
        border-top-color: var(--cor-destaque-primaria);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .brand-footer {
        opacity: 0.3;
        font-size: 1.1rem;
        font-weight: 600;
        letter-spacing: 2px;
        color: var(--cor-texto-claro);
        user-select: none; /* N√£o selecion√°vel */
        border-top: 1px solid var(--cor-card-borda);
        padding-top: 1rem;
      }
      .table-custom th .bi {
        vertical-align: -0.125em;
        margin-right: 0.3rem;
      }
      /* --- SweetAlert2 no tema Ciano --- */
      .swal2-popup {
        background: var(--cor-fundo-gradiente-1) !important;
        color: var(--cor-texto-branco) !important;
        border: 1px solid var(--cor-card-borda) !important;
        border-radius: 15px !important;
      }
      .swal2-title {
        color: var(--cor-texto-branco) !important;
      }
      .swal2-html-container {
        color: var(--cor-texto-claro) !important;
      }
      .swal2-confirm,
      .swal2-cancel,
      .swal2-deny {
        border-radius: 0.375rem !important;
        font-weight: 600 !important;
      }
      .swal2-confirm {
        background-color: var(--cor-destaque-primaria) !important;
        color: var(--cor-fundo-gradiente-1) !important;
      }
      .swal2-confirm:hover {
        background-color: var(--cor-destaque-secundaria) !important;
      }
      .swal2-cancel {
        background-color: transparent !important;
        color: var(--cor-texto-claro) !important;
        border: 1px solid var(--cor-card-borda) !important;
      }
      .swal2-cancel:hover {
        background-color: var(--cor-card-fundo-hover) !important;
        color: var(--cor-texto-branco) !important;
      }
      .swal2-toast {
        border: 1px solid var(--cor-card-borda) !important;
        box-shadow: 0 8px 25px var(--cor-shadow-intensa) !important;
      }
    </style>
  </head>
  <body>
    <div class="aurora-container">
      <div class="aurora-blob" style="--cor-blob: #0d47a1"></div>
      <div class="aurora-blob" style="--cor-blob: #4a148c"></div>
      <div class="aurora-blob" style="--cor-blob: #00bcd4"></div>
      <div class="aurora-blob" style="--cor-blob: #ad1457"></div>
      </div>

    <div id="loading-overlay">
      <div class="spinner"></div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="#"
          ><i class="bi bi-person-vcard me-2"></i>{{empresa}}</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarContent"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            {% for item in menus %} {% if item.submenu %}
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                {{ item.title }}
              </a>
              <ul class="dropdown-menu">
                {% for sub in item.submenu %}
                <li>
                  <a class="dropdown-item" href="{{ sub.url }}"
                    >{{ sub.title }}</a
                  >
                </li>
                {% endfor %}
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{{ item.url }}">{{ item.title }}</a>
            </li>
            {% endif %} {% endfor %}
          </ul>
          <ul class="navbar-nav mb-2 mb-lg-0 align-items-center">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-circle me-1"></i> Perfil
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <span class="dropdown-item-text"
                    ><strong>{{ username }}</strong></span
                  >
                </li>
                <li>
                  <span class="dropdown-item-text text-muted small"
                    >{{ user_username }}</span
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="/logout"
                    ><i class="bi bi-box-arrow-right me-2"></i> Sair</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid px-3 px-md-4">
      <div class="dashboard-container mx-auto">
        <p id="saudacao" class="fs-5 mb-1 text-white">Carregando...</p>

        <div
          class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-3"
        >
          <form
            method="GET"
            action="/prestadoresdeservico"
            class="ms-md-auto"
            style="min-width: 300px; max-width: 450px; width: 100%"
          >
            <div class="input-group">
              <input
                type="text"
                class="form-control form-control-custom"
                id="search"
                name="search"
                placeholder="Filtrar por CPF, Nome, CNPJ..."
                value="{{ search_term or '' }}"
              />
              <button class="btn btn-search-custom" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>
        </div>

        <div class="table-container-custom">
          <div class="table-responsive">
            <table class="table table-custom table-striped align-middle">
              <thead>
                <tr>
                  <th scope="col"><i class="bi bi-person"></i> Nome Completo</th>
                  <th scope="col">
                    <i class="bi bi-card-text"></i> CPF Prestador
                  </th>
                  <th scope="col"><i class="bi bi-building"></i> CNPJ</th>
                  <th scope="col">
                    <i class="bi bi-briefcase"></i> Raz√£o Social
                  </th>
                  <th scope="col">
                    <i class="bi bi-journal-bookmark"></i> Class. Contabil
                  </th>
                  <th scope="col">
                    <i class="bi bi-person-check"></i> Nome Aprovador
                  </th>
                  <th scope="col">
                    <i class="bi bi-card-text"></i> CPF Aprovador
                  </th>
                  <th scope="col">
                    <i class="bi bi-gear-wide-connected"></i> A√ß√µes
                  </th>
                </tr>
              </thead>
              <tbody id="tabelaAprovadoresBody">
                {% for colaborador in colaboradores %}
                <tr>
                  <td>
                    {{ colaborador.nomecompleto.title() if
                    colaborador.nomecompleto else '' }}
                  </td>

                  <td>{{ colaborador.cpf_prestador }}</td>
                  <td>{{ colaborador.cnpj if colaborador.cnpj else '' }}</td>
                  <td>
                    {{ colaborador.razao_social.title() if
                    colaborador.razao_social else '' }}
                  </td>
                  <td>
                    {{ colaborador.classificacao_contabil if
                    colaborador.classificacao_contabil else '' }}
                  </td>
                  <td>
                    {{ colaborador.nome_aprovador.title() if
                    colaborador.nome_aprovador else '' }}
                  </td>
                  <td>
                    {{ colaborador.cpf_aprovador if colaborador.cpf_aprovador
                    else '' }}
                  </td>
                  <td>
                    <button
                      class="btn btn-sm btn-warning me-1"
                      title="Alterar"
                      data-bs-toggle="modal"
                      data-bs-target="#modalAlterarColaborador"
                      data-id="{{ colaborador.id }}"
                      data-cpf="{{ colaborador.cpf_prestador }}"
                      data-nome="{{ colaborador.nomecompleto }}"
                      data-cnpj="{{ colaborador.cnpj if colaborador.cnpj else '' }}"
                      data-razao_social="{{ colaborador.razao_social if colaborador.razao_social else '' }}"
                      data-nome_aprovador="{{ colaborador.nome_aprovador if colaborador.nome_aprovador else '' }}"
                      data-cpf_aprovador="{{ colaborador.cpf_aprovador if colaborador.cpf_aprovador else '' }}"
                    >
                      <i class="bi bi-pencil-square me-1"></i>
                    </button>
                    
                  </td>
                </tr>
                {% endfor %} {% if not colaboradores %}
                <tr>
                  <td
                    colspan="8"
                    class="text-center text-muted fst-italic"
                  >
                    Nenhum prestador encontrado.
                  </td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>

        {% if total_pages > 1 %}
        <nav aria-label="Navega√ß√£o da p√°gina" class="mt-4">
          <ul class="pagination justify-content-end">
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
              <a
                class="page-link"
                href="/prestadoresdeservico?page={{ page - 1 }}{% if search_term %}&search={{ search_term }}{% endif %}"
                aria-label="Anterior"
              >
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
            {% for page_num in range(1, total_pages + 1) %} {% if page_num ==
            page %}
            <li class="page-item active" aria-current="page">
              <span class="page-link">{{ page_num }}</span>
            </li>
            {% else %}
            <li class="page-item">
              <a
                class="page-link"
                href="/prestadoresdeservico?page={{ page_num }}{% if search_term %}&search={{ search_term }}{% endif %}"
              >
                {{ page_num }}
              </a>
            </li>
            {% endif %} {% endfor %}
            <li
              class="page-item {% if page == total_pages %}disabled{% endif %}"
            >
              <a
                class="page-link"
                href="/prestadoresdeservico?page={{ page + 1 }}{% if search_term %}&search={{ search_term }}{% endif %}"
                aria-label="Pr√≥ximo"
              >
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          </ul>
        </nav>
        {% endif %}

        <div class="brand-footer mt-4 text-uppercase">
          Toyota ‚Ä¢ Jeep ‚Ä¢ GWM ‚Ä¢ RAM ‚Ä¢ Land Rover ‚Ä¢ Porsche ‚Ä¢ Mercedes-Benz
        </div>
      </div>
    </div>

    <div class="dropdown">
      <button
        class="fab-base notification-button"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
        aria-label="Notifica√ß√µes"
      >
        <i class="bi bi-bell-fill"></i>
        {% if notification_count > 0 %}
        <span class="badge bg-danger rounded-pill"
          >{{ notification_count }}</span
        >
        {% endif %}
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        {% if notifications %} {% for note in notifications %}
        <li>
          <a class="dropdown-item" href="{{ note.url }}">{{ note.title }}</a>
        </li>
        {% endfor %} {% else %}
        <li>
          <span class="dropdown-item-text text-muted">Sem notifica√ß√µes</span>
        </li>
        {% endif %}
      </ul>
    </div>

    <button
      class="fab-base fab-add-button"
      type="button"
      data-bs-toggle="modal"
      data-bs-target="#modalAdicionarPrestador"
      aria-label="Adicionar Prestador"
    >
      <i class="bi bi-plus-lg"></i>
    </button>

    <div
      class="modal fade"
      id="modalAlterarColaborador"
      tabindex="-1"
      aria-labelledby="modalAlterarColaboradorLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content modal-content-custom">
          <div class="modal-header">
            <h5 class="modal-title" id="modalAlterarColaboradorLabel">
              <i class="bi bi-pencil-square me-2"></i>Alterar Prestador
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body">
            <form id="formAlterarColaborador">
              <input type="hidden" name="id" id="editId" />

              <p class="text-white">Dados do Prestador (N√£o edit√°vel)</p>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="editCPF" class="form-label">CPF Prestador</label>
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="editCPF"
                    name="cpf_prestador"
                    readonly
                    disabled
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="editNome" class="form-label"
                    >Nome Prestador</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="editNome"
                    name="nomecompleto"
                    readonly
                    disabled
                  />
                </div>
              </div>

              <hr class="dropdown-divider" />
              <p class="text-white mt-3">Dados da Empresa (Edit√°vel)</p>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="edit_cnpj" class="form-label">CNPJ</label>
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="edit_cnpj"
                    name="cnpj"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="edit_razao_social" class="form-label"
                    >Raz√£o Social</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="edit_razao_social"
                    name="razao_social"
                    required
                  />
                </div>
              </div>

              <hr class="dropdown-divider" />
              <p class="text-white mt-3">Dados do Aprovador (Edit√°vel)</p>
              <div class="mb-3">
                <label for="edit_searchAprovadorInput" class="form-label"
                  >Buscar Novo Aprovador (Base Postgres):</label
                >
                <div class="input-group">
                  <span
                    class="input-group-text"
                    style="
                      background-color: rgba(0, 0, 0, 0.2);
                      border-color: var(--cor-card-borda);
                      color: var(--cor-texto-claro);
                    "
                    ><i class="bi bi-search"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="edit_searchAprovadorInput"
                    placeholder="Digite o nome ou CPF do aprovador (m√≠n. 3 caracteres)"
                  />
                </div>
                <small class="form-text text-white-50"
                  >Busca nos aprovadores existentes (Postgres).</small
                >
              </div>

              <ul
                class="list-group"
                id="edit_searchAprovadorResultsList"
                style="
                  max-height: 150px;
                  overflow-y: auto;
                  background-color: transparent;
                  border-radius: 8px;
                "
              ></ul>

              <div
                id="edit_searchAprovadorSpinner"
                class="text-center my-2 d-none"
              >
                <div class="spinner-border text-info" role="status">
                  <span class="visually-hidden">Buscando...</span>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="edit_nome_aprovador" class="form-label"
                    >Nome Aprovador</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="edit_nome_aprovador"
                    name="nome_aprovador"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="edit_cpf_aprovador" class="form-label"
                    >CPF Aprovador</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="edit_cpf_aprovador"
                    name="cpf_aprovador"
                  />
                </div>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
            >
              <i class="bi bi-x-circle me-1"></i> Cancelar
            </button>
            <button
              type="button"
              id="btnAtualizarPrestador"
              class="btn btn-warning"
            >
              <i class="bi bi-arrow-repeat me-1"></i> Atualizar
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="modalAdicionarPrestador"
      tabindex="-1"
      aria-labelledby="modalAdicionarLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content modal-content-custom">
          <div class="modal-header">
            <h5 class="modal-title" id="modalAdicionarLabel">
              <i class="bi bi-person-plus-fill me-2"></i> Adicionar Novo
              Prestador
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="searchFuncionarioInput" class="form-label"
                >Buscar Funcion√°rio (Base Oracle):</label
              >
              <div class="input-group">
                <span
                  class="input-group-text"
                  style="
                    background-color: rgba(0, 0, 0, 0.2);
                    border-color: var(--cor-card-borda);
                    color: var(--cor-texto-claro);
                  "
                  ><i class="bi bi-search"></i
                ></span>
                <input
                  type="text"
                  class="form-control form-control-custom"
                  id="searchFuncionarioInput"
                  placeholder="Digite o nome ou CPF do funcion√°rio (m√≠n. 3 caracteres)"
                />
              </div>
              <small class="form-text text-white-50"
                >Busca na base de funcion√°rios (Oracle).</small
              >
            </div>

            <ul
              class="list-group"
              id="searchResultsList"
              style="
                max-height: 200px;
                overflow-y: auto;
                background-color: transparent;
                border-radius: 8px;
              "
            ></ul>
            <div id="searchSpinner" class="text-center my-2 d-none">
              <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">Buscando...</span>
              </div>
            </div>

            <hr class="dropdown-divider" />

            <div class="mb-3">
              <label for="searchAprovadorInput" class="form-label"
                >Buscar Aprovador Existente (Base Postgres):</label
              >
              <div class="input-group">
                <span
                  class="input-group-text"
                  style="
                    background-color: rgba(0, 0, 0, 0.2);
                    border-color: var(--cor-card-borda);
                    color: var(--cor-texto-claro);
                  "
                  ><i class="bi bi-search"></i
                ></span>
                <input
                  type="text"
                  class="form-control form-control-custom"
                  id="searchAprovadorInput"
                  placeholder="Digite o nome ou CPF do aprovador (m√≠n. 3 caracteres)"
                />
              </div>
              <small class="form-text text-white-50"
                >Busca nos aprovadores existentes (Postgres).</small
              >
            </div>

            <ul
              class="list-group"
              id="searchAprovadorResultsList"
              style="
                max-height: 150px; /* Um pouco menor */
                overflow-y: auto;
                background-color: transparent;
                border-radius: 8px;
              "
            ></ul>

            <div id="searchAprovadorSpinner" class="text-center my-2 d-none">
              <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">Buscando...</span>
              </div>
            </div>
            <p class="text-white mt-3">
              Dados para Cadastro do Prestador (Base Postgres)
            </p>
            <form id="formAdicionarPrestador">
              <input
                type="hidden"
                id="add_cpf_prestador"
                name="cpf_prestador"
              />
              <input
                type="hidden"
                id="add_classificacao_contabil"
                name="classificacao_contabil"
              />
              <input
                type="hidden"
                id="add_nomecompleto"
                name="nomecompleto"
              />

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="add_razao_social" class="form-label"
                    >Raz√£o Social
                    <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="add_razao_social"
                    name="razao_social"
                    required
                  />
                </div>

                <div class="col-md-6 mb-3">
                  <label for="add_cnpj" class="form-label">CNPJ</label>
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="add_cnpj"
                    name="cnpj"
                  />
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="add_nome_aprovador" class="form-label"
                    >Nome Aprovador</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="add_nome_aprovador"
                    name="nome_aprovador"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="add_cpf_aprovador" class="form-label"
                    >CPF Aprovador</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-custom"
                    id="add_cpf_aprovador"
                    name="cpf_aprovador"
                  />
                </div>
              </div>

              <div class="mb-3">
                <label for="selectedFuncionarioInfo" class="form-label"
                  >Funcion√°rio Selecionado:</label
                >
                <input
                  type="text"
                  class="form-control form-control-custom"
                  id="selectedFuncionarioInfo"
                  disabled
                  readonly
                  placeholder="Nenhum funcion√°rio selecionado"
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-success"
              id="btnSalvarPrestador"
            >
              <i class="bi bi-save me-1"></i> Salvar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      /*
      =================================================================
      O JavaScript √© o mesmo das vers√µes anteriores.
      A mudan√ßa de tema (Amarelo para Ciano) foi feita no CSS,
      incluindo os bot√µes do SweetAlert2 e os bot√µes "btn-warning".
      Nenhuma l√≥gica precisou mudar.
      =================================================================
      */

      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 3500,
        timerProgressBar: true,
        didOpen: (toast) => {
          toast.addEventListener("mouseenter", Swal.stopTimer);
          toast.addEventListener("mouseleave", Swal.resumeTimer);
        },
        customClass: {
          popup: "swal2-toast",
        },
      });

      function showToast(title, icon = "success") {
        Toast.fire({
          icon: icon,
          title: title,
        });
      }

      // Script da Sauda√ß√£o
      (function () {
        const hora = new Date().getHours();
        let saudacaoPrefixo = "Ol√°";
        if (hora >= 5 && hora < 12) saudacaoPrefixo = "Bom dia";
        else if (hora >= 12 && hora < 18) saudacaoPrefixo = "Boa tarde";
        else saudacaoPrefixo = "Boa noite";
        const username = "{{ username }}";
        const saudacaoEl = document.querySelector("#saudacao");
        if (saudacaoEl) {
          saudacaoEl.innerHTML = `üëã ${saudacaoPrefixo}, ${username}!`;
        }
      })();

      // Script do Loading Overlay
      (function () {
        const overlay = document.getElementById("loading-overlay");
        if (!overlay) return;
        window.onload = () => {
          overlay.style.opacity = "0";
          setTimeout(() => {
            overlay.style.display = "none";
          }, 300);
        };
      })();

      // SCRIPT DO MODAL ADICIONAR
      (function () {
        const modalEl = document.getElementById("modalAdicionarPrestador");
        if (!modalEl) return;
        const modal = new bootstrap.Modal(modalEl);
        const searchInput = document.getElementById("searchFuncionarioInput");
        const resultsList = document.getElementById("searchResultsList");
        const searchSpinner = document.getElementById("searchSpinner");
        const form = document.getElementById("formAdicionarPrestador");
        const saveButton = document.getElementById("btnSalvarPrestador");
        const selectedInfo = document.getElementById("selectedFuncionarioInfo");
        const formCpfPrestador = document.getElementById("add_cpf_prestador");
        const formClassContabil = document.getElementById(
          "add_classificacao_contabil"
        );
        const formRazaoSocial = document.getElementById("add_razao_social");
        const formNome = document.getElementById("add_nomecompleto");
        const searchAprovadorInput = document.getElementById(
          "searchAprovadorInput"
        );
        const resultsAprovadorList = document.getElementById(
          "searchAprovadorResultsList"
        );
        const searchAprovadorSpinner = document.getElementById(
          "searchAprovadorSpinner"
        );
        const formNomeAprovador = document.getElementById("add_nome_aprovador");
        const formCpfAprovador = document.getElementById("add_cpf_aprovador");
        let debounceAprovadorTimer;
        let debounceTimer;

        searchInput.addEventListener("keyup", (e) => {
          clearTimeout(debounceTimer);
          const query = e.target.value;
          if (query.length < 3) {
            resultsList.innerHTML = "";
            searchSpinner.classList.add("d-none");
            return;
          }
          searchSpinner.classList.remove("d-none");
          debounceTimer = setTimeout(() => {
            performSearch(query);
          }, 500);
        });

        async function performSearch(query) {
          resultsList.innerHTML = "";
          try {
            const response = await fetch(
              `/api/search-funcionarios?search=${encodeURIComponent(query)}`
            );
            if (!response.ok) throw new Error("Falha na busca");
            const funcionarios = await response.json();
            if (funcionarios.length === 0) {
              resultsList.innerHTML = `<li class="list-group-item" style="background-color: var(--cor-card-fundo); color: var(--cor-texto-claro); border-color: var(--cor-card-borda);">Nenhum funcion√°rio encontrado ou j√° cadastrado.</li>`;
            } else {
              funcionarios.forEach((func) => {
                const li = document.createElement("li");
                li.className = "list-group-item list-group-item-action";
                li.style =
                  "background-color: var(--cor-card-fundo); color: var(--cor-texto-branco); border-color: var(--cor-card-borda); cursor: pointer;";
                li.innerHTML = `<strong>${func.nomecompleto}</strong><br><small>CPF: ${func.cpf}  |  Classifica√ß√£o Cont√°bil: ${func.classificacao_contabil}</small>`;
                li.onclick = () => selectFuncionario(func);
                resultsList.appendChild(li);
              });
            }
          } catch (error) {
            console.error("Erro ao buscar funcion√°rios:", error);
            resultsList.innerHTML = `<li class="list-group-item list-group-item-danger" style="background-color: #5c2a2a; color: white; border-color: var(--cor-card-borda);">Erro ao buscar. Tente novamente.</li>`;
            showToast("Erro ao buscar funcion√°rios.", "error");
          } finally {
            searchSpinner.classList.add("d-none");
          }
        }

        window.selectFuncionario = (func) => {
          formCpfPrestador.value = func.cpf;
          formClassContabil.value = func.classificacao_contabil;
          formRazaoSocial.value = func.nomecompleto.toUpperCase();
          formNome.value = func.nomecompleto.toUpperCase();
          selectedInfo.value = `${func.nomecompleto} (CPF: ${func.cpf})`;
          resultsList.innerHTML = "";
          searchInput.value = "";
        };

        searchAprovadorInput.addEventListener("keyup", (e) => {
          clearTimeout(debounceAprovadorTimer);
          const query = e.target.value;
          if (query.length < 3) {
            resultsAprovadorList.innerHTML = "";
            searchAprovadorSpinner.classList.add("d-none");
            return;
          }
          searchAprovadorSpinner.classList.remove("d-none");
          debounceAprovadorTimer = setTimeout(() => {
            performAprovadorSearch(query);
          }, 500);
        });

        async function performAprovadorSearch(query) {
          resultsAprovadorList.innerHTML = "";
          try {
            const response = await fetch(
              `/api/search-aprovadores?search=${encodeURIComponent(query)}`
            );
            if (!response.ok) throw new Error("Falha na busca de aprovadores");
            const aprovadores = await response.json();
            if (aprovadores.length === 0) {
              resultsAprovadorList.innerHTML = `<li class="list-group-item" style="background-color: var(--cor-card-fundo); color: var(--cor-texto-claro); border-color: var(--cor-card-borda);">Nenhum aprovador encontrado.</li>`;
            } else {
              aprovadores.forEach((aprov) => {
                const li = document.createElement("li");
                li.className = "list-group-item list-group-item-action";
                li.style =
                  "background-color: var(--cor-card-fundo); color: var(--cor-texto-branco); border-color: var(--cor-card-borda); cursor: pointer;";
                const nome = aprov.nome_aprovador || "N/A";
                const cpf = aprov.cpf_aprovador || "N/A";
                li.innerHTML = `<strong>${nome}</strong><br><small>CPF: ${cpf}</small>`;
                li.onclick = () => selectAprovador(aprov);
                resultsAprovadorList.appendChild(li);
              });
            }
          } catch (error) {
            console.error("Erro ao buscar aprovadores:", error);
            resultsAprovadorList.innerHTML = `<li class="list-group-item list-group-item-danger" style="background-color: #5c2a2a; color: white; border-color: var(--cor-card-borda);">Erro ao buscar. Tente novamente.</li>`;
            showToast("Erro ao buscar aprovadores.", "error");
          } finally {
            searchAprovadorSpinner.classList.add("d-none");
          }
        }

        window.selectAprovador = (aprov) => {
          formNomeAprovador.value = aprov.nome_aprovador;
          formCpfAprovador.value = aprov.cpf_aprovador;
          resultsAprovadorList.innerHTML = "";
          searchAprovadorInput.value = "";
        };

        saveButton.addEventListener("click", async () => {
          if (!formCpfPrestador.value || !formRazaoSocial.value) {
            showToast(
              "Selecione um funcion√°rio e preencha a Raz√£o Social.",
              "warning"
            );
            return;
          }
          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());
          saveButton.disabled = true;
          saveButton.innerHTML =
            '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Salvando...';
          try {
            const response = await fetch("/api/add-prestador", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });
            const responseData = await response.json();
            if (!response.ok) {
              throw new Error(responseData.detail || "Erro desconhecido");
            }
            showToast("Prestador adicionado com sucesso!", "success");
            modal.hide();
            setTimeout(() => location.reload(), 1500);
          } catch (error) {
            console.error("Erro ao salvar:", error);
            showToast(`Erro ao salvar: ${error.message}`, "error");
          } finally {
            saveButton.disabled = false;
            saveButton.innerHTML = '<i class="bi bi-save me-1"></i> Salvar';
          }
        });

        modalEl.addEventListener("hidden.bs.modal", () => {
          form.reset();
          selectedInfo.value = "Nenhum funcion√°rio selecionado";
          formCpfPrestador.value = "";
          formClassContabil.value = "";
          resultsList.innerHTML = "";
          searchInput.value = "";
          resultsAprovadorList.innerHTML = "";
          searchAprovadorInput.value = "";
        });
      })();

      // SCRIPT DO MODAL ALTERAR
      (function () {
        const modalEl = document.getElementById("modalAlterarColaborador");
        if (!modalEl) return;
        const modal = new bootstrap.Modal(modalEl);
        const form = document.getElementById("formAlterarColaborador");
        const updateButton = document.getElementById("btnAtualizarPrestador");
        const inputId = modalEl.querySelector("#editId");
        const inputCPF = modalEl.querySelector("#editCPF");
        const inputNome = modalEl.querySelector("#editNome");
        const inputCnpj = modalEl.querySelector("#edit_cnpj");
        const inputRazaoSocial = modalEl.querySelector("#edit_razao_social");
        const inputNomeAprovador = modalEl.querySelector("#edit_nome_aprovador");
        const inputCpfAprovador = modalEl.querySelector("#edit_cpf_aprovador");
        const searchAprovadorInput = modalEl.querySelector(
          "#edit_searchAprovadorInput"
        );
        const resultsAprovadorList = modalEl.querySelector(
          "#edit_searchAprovadorResultsList"
        );
        const searchAprovadorSpinner = modalEl.querySelector(
          "#edit_searchAprovadorSpinner"
        );
        let debounceAprovadorTimer;

        modalEl.addEventListener("show.bs.modal", (event) => {
          const button = event.relatedTarget;
          inputId.value = button.getAttribute("data-id");
          inputCPF.value = button.getAttribute("data-cpf");
          inputNome.value = button.getAttribute("data-nome");
          inputCnpj.value = button.getAttribute("data-cnpj");
          inputRazaoSocial.value = button.getAttribute("data-razao_social");
          inputNomeAprovador.value = button.getAttribute("data-nome_aprovador");
          inputCpfAprovador.value = button.getAttribute("data-cpf_aprovador");
        });

        searchAprovadorInput.addEventListener("keyup", (e) => {
          clearTimeout(debounceAprovadorTimer);
          const query = e.target.value;
          if (query.length < 3) {
            resultsAprovadorList.innerHTML = "";
            searchAprovadorSpinner.classList.add("d-none");
            return;
          }
          searchAprovadorSpinner.classList.remove("d-none");
          debounceAprovadorTimer = setTimeout(() => {
            performAprovadorSearch_Edit(query);
          }, 500);
        });

        async function performAprovadorSearch_Edit(query) {
          resultsAprovadorList.innerHTML = "";
          try {
            const response = await fetch(
              `/api/search-aprovadores?search=${encodeURIComponent(query)}`
            );
            if (!response.ok) throw new Error("Falha na busca de aprovadores");
            const aprovadores = await response.json();
            if (aprovadores.length === 0) {
              resultsAprovadorList.innerHTML = `<li class="list-group-item" style="background-color: var(--cor-card-fundo); color: var(--cor-texto-claro); border-color: var(--cor-card-borda);">Nenhum aprovador encontrado.</li>`;
            } else {
              aprovadores.forEach((aprov) => {
                const li = document.createElement("li");
                li.className = "list-group-item list-group-item-action";
                li.style =
                  "background-color: var(--cor-card-fundo); color: var(--cor-texto-branco); border-color: var(--cor-card-borda); cursor: pointer;";
                const nome = aprov.nome_aprovador || "N/A";
                const cpf = aprov.cpf_aprovador || "N/A";
                li.innerHTML = `<strong>${nome}</strong><br><small>CPF: ${cpf}</small>`;
                li.onclick = () => selectAprovador_Edit(aprov);
                resultsAprovadorList.appendChild(li);
              });
            }
          } catch (error) {
            console.error("Erro ao buscar aprovadores:", error);
            resultsAprovadorList.innerHTML = `<li class="list-group-item list-group-item-danger" style="background-color: #5c2a2a; color: white; border-color: var(--cor-card-borda);">Erro ao buscar. Tente novamente.</li>`;
            showToast("Erro ao buscar aprovadores.", "error");
          } finally {
            searchAprovadorSpinner.classList.add("d-none");
          }
        }

        function selectAprovador_Edit(aprov) {
          inputNomeAprovador.value = aprov.nome_aprovador;
          inputCpfAprovador.value = aprov.cpf_aprovador;
          resultsAprovadorList.innerHTML = "";
          searchAprovadorInput.value = "";
        }

        updateButton.addEventListener("click", async () => {
          if (!inputRazaoSocial.value) {
            showToast("O campo Raz√£o Social √© obrigat√≥rio.", "warning");
            return;
          }
          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());
          data.cpf_prestador = inputCPF.value;
          data.nomecompleto = inputNome.value;
          updateButton.disabled = true;
          updateButton.innerHTML =
            '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Atualizando...';
          try {
            const response = await fetch("/api/update-prestador", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            });
            const responseData = await response.json();
            if (!response.ok) {
              throw new Error(responseData.detail || "Erro desconhecido");
            }
            showToast("Prestador atualizado com sucesso!", "success");
            modal.hide();
            setTimeout(() => location.reload(), 1500);
          } catch (error) {
            console.error("Erro ao atualizar:", error);
            showToast(`Erro ao atualizar: ${error.message}`, "error");
          } finally {
            updateButton.disabled = false;
            updateButton.innerHTML =
              '<i class="bi bi-arrow-repeat me-1"></i> Atualizar';
          }
        });

        modalEl.addEventListener("hidden.bs.modal", () => {
          form.reset();
          resultsAprovadorList.innerHTML = "";
          searchAprovadorInput.value = "";
        });
      })();

      // SCRIPTS DE BUSCA DE CNPJ
      (function () {
        const cnpjInput = document.getElementById("add_cnpj");
        if (!cnpjInput) return;
        const razaoSocialInput = document.getElementById("add_razao_social");
        cnpjInput.addEventListener("blur", () => {
          buscarDadosCNPJ(cnpjInput.value, razaoSocialInput, cnpjInput);
        });
      })();

      (function () {
        const cnpjInput = document.getElementById("edit_cnpj");
        if (!cnpjInput) return;
        const razaoSocialInput = document.getElementById("edit_razao_social");
        cnpjInput.addEventListener("blur", () => {
          buscarDadosCNPJ(cnpjInput.value, razaoSocialInput, cnpjInput);
        });
      })();

      async function buscarDadosCNPJ(cnpjValor, inputRazaoSocial, inputCNPJ) {
        const cnpj = cnpjValor.replace(/\D/g, "");
        if (cnpj.length === 14) {
          inputCNPJ.disabled = true;
          const originalPlaceholder = inputRazaoSocial.placeholder;
          inputRazaoSocial.value = "Buscando dados na BrasilAPI...";
          const url = `https.proxy.pagecdn.io/proxy?url=https://brasilapi.com.br/api/cnpj/v1/${cnpj}`;
          try {
            // Adicionado um 'wrapper' de proxy para evitar problemas de CORS
            // se este script for rodado de um dom√≠nio diferente.
            // Se for o mesmo dom√≠nio, pode usar a URL direta.
            const response = await fetch(
              `https://brasilapi.com.br/api/cnpj/v1/${cnpj}`
            );
            if (!response.ok) {
              throw new Error("CNPJ n√£o encontrado ou inv√°lido.");
            }
            const data = await response.json();
            if (data.razao_social) {
              inputRazaoSocial.value = data.razao_social;
              showToast("Raz√£o Social preenchida.", "success");
            } else {
              inputRazaoSocial.value = "";
              showToast("CNPJ encontrado, mas sem Raz√£o Social.", "info");
            }
          } catch (error) {
            console.error("Erro ao buscar CNPJ:", error.message);
            inputRazaoSocial.value = "";
            inputRazaoSocial.placeholder = originalPlaceholder;
            showToast(error.message, "error");
            // Tenta buscar via API de proxy se a direta falhar (ex: CORS)
            try {
              const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(
                `https://brasilapi.com.br/api/cnpj/v1/${cnpj}`
              )}`;
              const proxyResponse = await fetch(proxyUrl);
              const proxyData = await proxyResponse.json();
              const data = JSON.parse(proxyData.contents);

              if (data.razao_social) {
                inputRazaoSocial.value = data.razao_social;
                showToast("Raz√£o Social preenchida (via proxy).", "success");
              } else {
                showToast(
                  "Erro na BrasilAPI. Tente digitar manualmente.",
                  "warning"
                );
              }
            } catch (proxyError) {
              showToast("Falha ao buscar CNPJ. Digite manualmente.", "error");
            }
          } finally {
            inputCNPJ.disabled = false;
          }
        } else if (cnpj.length > 0) {
          showToast("CNPJ incompleto.", "warning");
        }
      }

      // Fun√ß√£o de Exclus√£o com SweetAlert2
      async function confirmarExclusao(id) {
        Swal.fire({
          title: "Tem certeza?",
          text: "Voc√™ realmente deseja excluir este prestador? Esta a√ß√£o n√£o pode ser desfeita.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Sim, excluir!",
          cancelButtonText: "Cancelar",
          reverseButtons: true,
        }).then(async (result) => {
          if (result.isConfirmed) {
            try {
              const response = await fetch(`/api/delete-prestador/${id}`, {
                method: "DELETE",
              });
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(
                  errorData.detail || "Falha ao excluir o prestador."
                );
              }
              Swal.fire(
                "Exclu√≠do!",
                "O prestador foi removido com sucesso.",
                "success"
              );
              setTimeout(() => location.reload(), 1500);
            } catch (error) {
              console.error("Erro ao excluir:", error);
              Swal.fire(
                "Erro!",
                `N√£o foi poss√≠vel excluir: ${error.message}`,
                "error"
              );
            }
          }
        });
      }
      async function excluirPrestador(id) {
        console.warn("Fun√ß√£o 'excluirPrestador' foi substitu√≠da.");
        confirmarExclusao(id);
      }
    </script>
  </body>
</html>